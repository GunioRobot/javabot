<project name="javabot" default="main">

	<property file="build.properties"/>
	<property environment="env"/>
	<property name="build" location="build"/>
	<property name="src.zip" value="share/src.zip"/>
	<property name="src.version" value="1.4"/>
	
	<path id="javabot.cp">
		<fileset dir="lib" includes="*.jar"/>
		
		<!-- Note: this is unnecessary if tools.jar is in your classpath
		by default (i.e. on Mac OS X systems) -->
		<fileset dir="${env.JAVA_HOME}/lib" includes="tools.jar"/>
		<!--.-->
		
		<pathelement path="${build}"/>
	</path>

	<uptodate property="docref.uptodate" targetfile="docref.xml"
		srcfile="${env.JAVA_HOME}/${src.zip}"/>

	<target name="init">
		<mkdir dir="${build}"/>
	</target>
	
	<target name="main" depends="init">
		<javac destDir="${build}" srcDir="src" classpathref="javabot.cp"
			debug="true"/>
        <antcall target="buildxml"/>
	</target>

	<target name="clean">
		<delete dir="${build}"/>
	</target>
	
	<target name="rebuild" depends="clean, main"/>

	<target name="test" depends="main">
		<junit haltonfailure="true" reloading="false">
			<formatter type="brief" usefile="no"/>
			<classpath refid="javabot.cp"/>
			<batchtest>
				<fileset dir="src">
					<include name="tests/*.java"/>
				</fileset>
			</batchtest>
		</junit>
	</target>

	<target name="buildxml"  unless="docref.uptodate">
        <unzip src="${env.JAVA_HOME}/${src.zip}" dest="docRefBuild"/>
		<javadoc
			sourcepath="docRefBuild"
			packagenames="*"
			excludepackagenames="com.sun.*, org.apache.*"
			maxmemory="384m"
			source="${src.version}"
			docletpathref="javabot.cp"
		>
			<doclet name="javabot.javadoc.StructureDoclet">
				<param name="-x" value="docref.xml"/>
			</doclet>
		</javadoc>
        <delete dir="docRefBuild"/>
	</target>

	<target name="killbot" depends="main">
		<java classname="javabot.Killbot" classpathref="javabot.cp" fork="true"/>
	</target>
	
	<target name="run" depends="killbot">
		<java classname="javabot.Javabot" classpathref="javabot.cp" fork="true" spawn="true"/>
	</target>
</project>
